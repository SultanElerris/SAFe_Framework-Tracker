{"version":3,"sources":["../../config/router.js"],"names":[],"mappings":"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","file":"router.js","sourcesContent":["(function () {'use strict';\r\n\tvar app = angular.module('piStatus');\r\n\r\n\tapp.provider('routeSvc', function(){\r\n\t\tthis.verifyUser = ['$q', 'authSvc', 'userSvc', function($q, authSvc, userSvc){\r\n\t\t\tvar _defer = $q.defer();\r\n\t\t\tauthSvc.auth().$requireSignIn()\r\n\t\t\t.then(function(user){\r\n\t\t\t\tif(user.email === 'system@gmail.com') { _defer.reject('SYSTEM_USER_NOT_ALLOWED'); }\r\n\t\t\t\treturn userSvc.getLoggedInUser();\r\n\t\t\t})\r\n\t\t\t.then(function(user){\r\n\t\t\t\t_defer.resolve(user);\r\n\t\t\t})\r\n\t\t\t.catch(function(error){\r\n\t\t\t\t_defer.reject(error);\r\n\t\t\t});\r\n\t\t\treturn _defer.promise;\r\n\t\t}];\r\n\t\tthis.$get = function() { return {}; };\r\n\t});\r\n\r\n\r\n\tapp.config(function ($stateProvider, $urlRouterProvider, $locationProvider, routeSvcProvider) {\r\n\t\t// use the HTML5 History API\r\n    $locationProvider.html5Mode(true);\r\n\r\n\t\t$stateProvider\r\n      .state('default', {\r\n\t\t\t\turl: '/',\r\n\t\t\t\ttemplateUrl: '/routes/login/login.html'\r\n\t\t\t})\r\n\t\t\t.state('forgotpassword', {\r\n\t\t\t\turl: '/forgotpassword',\r\n\t\t\t\ttemplateUrl: '/routes/forgotpassword/forgotpassword.html',\r\n\t\t\t})\r\n\t\t\t.state('home', {\r\n\t\t\t\turl: '/home',\r\n\t\t\t\ttemplateUrl: '/routes/home/home.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user, userSvc){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t\tuserSvc.context().set(user);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('organization', {\r\n\t\t\t\turl: '/organization',\r\n\t\t\t\ttemplateUrl: '/routes/organization/organization.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('team-list', {\r\n\t\t\t\turl: '/team/list',\r\n\t\t\t\ttemplateUrl: '/routes/team/list.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('scrum-master-list', {\r\n\t\t\t\turl: '/users/list',\r\n\t\t\t\ttemplateUrl: '/routes/users/scrum-masters.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('program-increment-list', {\r\n\t\t\t\turl: '/programincrement/list',\r\n\t\t\t\ttemplateUrl: '/routes/setup/programincrement.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('objectives-list', {\r\n\t\t\t\turl: '/objectives/list',\r\n\t\t\t\ttemplateUrl: '/routes/list-objectives/objectives.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('objectives-list-all-teams', {\r\n\t\t\t\turl: '/objectives/all-teams/list',\r\n\t\t\t\ttemplateUrl: '/routes/list-objectives/all-teams.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: routeSvcProvider.verifyUser\r\n\t\t\t\t},\r\n\t\t\t\tcontroller: function($scope, user){\r\n\t\t\t\t\t$scope.user = user;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.state('dashboard', {\r\n\t\t\t\turl: '/dashboard',\r\n\t\t\t\ttemplateUrl: '/routes/dashboard/dashboard.html',\r\n\t\t\t\tresolve:{\r\n\t\t\t\t\tuser: function(authSvc){\r\n\t\t\t\t\t \treturn authSvc.loginAsSystem();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tverifyLink: function($q, $timeout, $location, userSvc, storageSvc){\r\n\t\t\t\t\t\tvar _defer = $q.defer();\r\n\t\t\t\t\t\tvar param = $location.search().guid;\r\n\t\t\t\t\t\tif(param){\r\n\t\t\t\t\t\t\tvar passedGuid = param.split('~~');\r\n\t\t\t\t\t\t\tvar piId = passedGuid[0];\r\n\t\t\t\t\t\t\tvar orgId = passedGuid[1];\r\n\t\t\t\t\t\t\tvar context = userSvc.context().get();\r\n\t\t\t\t\t\t\tif(!context){\r\n\t\t\t\t\t\t\t\tstorageSvc.save({ key: 'user', data: { orgId: orgId, userRole: 1 } });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_defer.resolve();\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$timeout(function(){ _defer.reject('INVALID_DASHBOARD_LINK') },100)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn _defer.promise;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// ========================================================== //\r\n\t}).run(function($rootScope, $state, authSvc, toastHelp){\r\n\t\t$rootScope.$on('$stateChangeError', function(e, toState, toParams, fromState, fromParams, error){\r\n\t\t\tif (error === \"AUTH_REQUIRED\") {\r\n\t\t\t\ttoastHelp.error('Login again to use the application', 'Error');\r\n      \t$state.go('default');\r\n    \t}\r\n\t\t\tif (error === \"INVALID_DASHBOARD_LINK\") {\r\n\t\t\t\ttoastHelp.error('Invalid dashboard Link', 'Error');\r\n      \t$state.go('default');\r\n    \t}\r\n\t\t\tif (error === \"USER_DELETED\") {\r\n\t\t\t\ttoastHelp.error('There is no user record corresponding to this identifier. The user may have been deleted.', 'Error');\r\n\t\t\t\tauthSvc.deleteUser().then(function(){\r\n\t\t\t\t\t$state.go('default');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(error === 'SYSTEM_USER_NOT_ALLOWED'){\r\n\t\t\t\t$state.go('default');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$rootScope.$on('$stateChangeStart', function(e, toState, toParams, fromState, fromParams, error){\r\n\t\t\tif(toState.name === 'default'){\r\n\t\t\t\tfirebase.auth().onAuthStateChanged(function(user){\r\n\t\t\t\t\tif(user) { $state.go('home'); }\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t})\r\n\r\n\r\n\r\n\r\n}());\r\n"]}